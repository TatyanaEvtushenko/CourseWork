<errorpage *ngIf="storage.isReadyCurrentUser && !storage.isConfirmedUser"></errorpage>
<div *ngIf="storage.isReadyCurrentUser && storage.isConfirmedUser" class="container">
    <h4>{{translations['CREATENEWPROJECT']}}</h4>

    <div class="row">
        <div class="col m6">
            <div class="input-field">
                <input id="project-name" #projectname="ngModel" class="validate" required [(ngModel)]="projectForm.name" type="text" />
                <label for="project-name">{{translations['NAME']}}</label>
            </div>
        </div>
        <div class="col m6">
            <div class="input-field">
                <input id="project-datepicker" #projectdate="ngModel" name="datepicker" [(ngModel)]="projectForm.fundRaisingEnd" required materialize="pickadate"
                       type="text" [materializeParams]="[{format: 'dd/mm/yyyy'}]" />
                <label for="project-datepicker">{{translations['FUNDRAISINGEND']}}</label>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col m12">
            <markdowneditor [fieldName]="translations['DESCR']" [text]="projectForm.description" (onChanged)="projectForm.description = $event"></markdowneditor> 
        </div>
    </div>

    <div class="row">
        <div class="col m6">
            <imageloader id="project-image" (emitter)="projectForm.imageBase64 = $event" [fieldName]="translations['IMAGE']"></imageloader>
        </div>
        <div class="col m3">
            <div class="input-field">
                <input id="project-minpayment" #projectMinPayment="ngModel" class="validate" required [(ngModel)]="projectForm.minPaymentAmount" type="number" />
                <label for="project-minpayment">{{translations['MINPAYMENT']}}, $</label>
            </div>
        </div>
        <div class="col m3">
            <div class="input-field">
                <input id="project-maxpayment" #projectMaxPayment="ngModel" class="validate" required [(ngModel)]="projectForm.maxPaymentAmount" type="number" />
                <label for="project-maxpayment">{{translations['MAXPAYMENT']}}, $</label>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col m11">
            <div class="input-field">
                <h6 class="grey-text">{{translations['FINANCIALPURPOSES']}}</h6>
                <hr *ngIf="projectForm.financialPurposes.length < 1"/>
                <financialpurposes *ngIf="projectForm.financialPurposes.length >= 1" 
                                   [(financialPurposes)]="projectForm.financialPurposes" [canChange]="true"></financialpurposes>
            </div>
        </div>
        <div class="col m1">
            <div class="input-field">
                <a href="#financialPurposeModal" class="btn modal-trigger"><i class="material-icons">add</i></a>
            </div>
        </div>
        <financialpurposemodal (onCreated)="addFinancialPurpose($event)"></financialpurposemodal>
    </div>

    <div class="row">
        <div class="col m12">
            <tagsearcher [(data)]="projectForm.tags"></tagsearcher>
        </div>
    </div>

    <div class="row">
        <div class="col m2 offset-m5">
            <div class="input-field">
                <button [disabled]="projectname.invalid || projectdate.invalid || projectMinPayment.invalid || projectMaxPayment.invalid || projectForm.financialPurposes.length < 1 || projectForm.imageBase64 == null || projectForm.minPaymentAmount > projectForm.maxPaymentAmount || projectForm.fundRaisingEnd < getTodayDate()" 
                        class="btn btn-large" (click)="onSubmit()">{{translations['CREATE']}}</button>
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="col m12 center-align">
            <errortext *ngIf="isWrongRequest" [text]="translations['PROJECTERROR']"></errortext>
        </div>
    </div>
</div>