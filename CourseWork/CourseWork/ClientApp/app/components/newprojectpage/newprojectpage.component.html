<errorpage *ngIf="storage.isReadyCurrentUser && !storage.isConfirmedUser"></errorpage>
<div *ngIf="storage.isReadyCurrentUser && storage.isConfirmedUser" class="container">
    <h4>Create a new project</h4>

    <div class="row">
        <div class="col m6">
            <div class="input-field">
                <input id="project-name" #projectname="ngModel" class="validate" required [(ngModel)]="projectForm.name" type="text" />
                <label for="project-name">Name</label>
            </div>
        </div>
        <div class="col m6">
            <div class="input-field">
                <input id="project-datepicker" #projectdate="ngModel" name="datepicker" [(ngModel)]="projectForm.fundRaisingEnd" required materialize="pickadate"
                       type="text" [materializeParams]="[{format: 'dd/mm/yyyy'}]" />
                <label for="project-datepicker">End of fundraising</label>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col m12">
            <markdowneditor [fieldName]="'Description'" [text]="projectForm.description" (onChanged)="projectForm.description = $event"></markdowneditor> 
        </div>
    </div>

    <div class="row">
        <div class="col m6">
            <imageloader id="project-image" (emitter)="projectForm.imageBase64 = $event" [fieldName]="'Image'"></imageloader>
        </div>
        <div class="col m3">
            <div class="input-field">
                <input id="project-minpayment" #projectMinPayment="ngModel" class="validate" required [(ngModel)]="projectForm.minPaymentAmount" type="number" />
                <label for="project-minpayment">Min payment, $</label>
            </div>
        </div>
        <div class="col m3">
            <div class="input-field">
                <input id="project-maxpayment" #projectMaxPayment="ngModel" class="validate" required [(ngModel)]="projectForm.maxPaymentAmount" type="number" />
                <label for="project-maxpayment">Max payment, $</label>
            </div>
        </div>
        <div class="col m3">
            <div class="input-field">
                <input id="project-id" #projectId="ngModel" class="validate" required [(ngModel)]="projectForm.id" type="text" />
                <label for="project-id">Path</label>
            </div>
        </div>
        <div class="col m3">
            <div class="input-field">
                <input id="project-accountnumber" #projectAccountNumber="ngModel" class="validate" required
                       [(ngModel)]="projectForm.accountNumber" type="text" />
                <label for="project-accountnumber">Account number</label>
            </div>
        </div>
        <div class="col m3">
            <div class="input-field">
                <input [(colorPicker)]="projectForm.color" [style.background]="projectForm.color" [value]="projectForm.color" id="project-color"/>
                <label for="project-color">Main color of your project page</label>
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="col m11">
            <div class="input-field">
                <h6 class="grey-text">Financial purposes</h6>
                <hr *ngIf="projectForm.financialPurposes.length < 1"/>
                <financialpurposes *ngIf="projectForm.financialPurposes.length >= 1" 
                                   [(financialPurposes)]="projectForm.financialPurposes" [canChange]="true"></financialpurposes>
            </div>
        </div>
        <div class="col m1">
            <div class="input-field">
                <a href="#financialPurposeModal" class="btn modal-trigger"><i class="material-icons">add</i></a>
            </div>
        </div>
        <financialpurposemodal (onCreated)="addFinancialPurpose($event)"></financialpurposemodal>
    </div>

    <div class="row">
        <div class="col m12">
            <tagsearcher [(data)]="projectForm.tags"></tagsearcher>
        </div>
    </div>

    <div class="row">
        <div class="col m2 offset-m5">
            <div class="input-field">
                <button [disabled]="projectname.invalid || projectdate.invalid || projectMinPayment.invalid || projectMaxPayment.invalid || projectForm.financialPurposes.length < 1 || projectForm.imageBase64 == null || projectForm.minPaymentAmount > projectForm.maxPaymentAmount || projectForm.fundRaisingEnd >= timeHelper.getNowTime()" 
                        class="btn btn-large" (click)="onSubmit()">Create</button>
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="col m12 center-align">
            <errortext *ngIf="isWrongRequest" [text]="'Mistake, the project has not been created'"></errortext>
        </div>
    </div>
</div>